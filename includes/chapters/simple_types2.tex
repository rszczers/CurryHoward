\section{Rachunek \(\lambda\) z typami prostymi}
\subsection{Typy proste}\label{ssec:typy-proste}
Niech \(U\) będzie przeliczalnie nieskończonym zbiorem zmiennych przedmiotowych \(p,\ q,\ \dots\ \) (być może indeksowanych liczbami naturalnymi), które będziemy nazywali \emph{zmiennymi typowymi}.

\begin{definicja}\label{def:typy-proste}(Typy proste)
\emph{Typami prostymi} będziemy określali najmniejszy w sensie mnogościowym zbiór wyrażeń taki, że:
\begin{enumerate}[label=(S\arabic*)]
  \setlength\itemsep{0em}
  \item Jeśli \(p\) jest zmienną typową, to \(p\) jest typem prostym.\label{def:t-1}
  \item Jeśli \(\sigma\) i \(\tau\) są typami prostymi, to \(\left(\sigma\to\tau\right)\) jest typem prostym.\label{def:t-2}
\end{enumerate}
\end{definicja}

Typy proste zbudowane tylko wedle reguły \ref{def:t-1} nazywamy typami \emph{atomowymi}, zaś wyrażenia zbudowe wedle reguły \ref{def:t-2} -- typami \emph{funkcyjnymi}. Zbiór typów prostych określony w myśl powyższej definicji będziemy oznaczali przez \(\mathbb{T}\). Definicję \ref{def:typy-proste} można równoznacznie wyrazić przy pomocy notacji Backusa-Naura. Wówczas ma ona następującą, zwięzłą postać:
\begin{align*}
  \mathbb{T}\ \leftarrow \ U\ |\ (\mathbb{T}\to\mathbb{T})
\end{align*}

Późniejsze litery alfabetu greckiego (\(\sigma,\, \tau,\, \rho,\,\dots\)), być może z indeksami, będą służyły nam za zmienne metasyntaktyczne do oznaczania typów prostych. Dla lepszej czytelności będziemy pomijali najbardziej zewnętrzne nawiasy. Konstruktor typu \(\to\) wiąże prawostronnie; oznacza to, że typy \(\sigma\to\tau\to\rho\) oraz \(\sigma\to(\tau\to\rho)\) będziemy uznawali za tożsame.

Zauważmy, że obiekty skonstruowane w myśl Definicji \ref{def:typy-proste} mają strukturę drzewa binarnego. Wysokość takiego drzewa będziemy nazywali \emph{stopniem} typu. 
\begin{definicja}\label{def:stopien-typu}(Stopień typu)
  Stopniem typu nazywamy następująco określoną funkcję \(\delta :\: \mathbb{T} \to \mathbb{N}\)
  \begin{align*}
    \delta(p) &= 0,\ \text{gdzie \(p\) jest typem atomowym},\\
    \delta(\sigma\to\sigma)&=1 + \max\left(\delta(\sigma),\ \delta(\sigma)\right).
  \end{align*}
\end{definicja}

% \subsection{Pseudotermy}
%   Niech \(\mathrm{V}\) będzie przeliczalnie nieskończonym zbiorem zmiennych przedmiotowych \(x,\ y,\ \dots\ \) (indeksowanych być może liczbami naturalnymi). Elementy takiego zbioru będziemy nazywali \emph{\(\lambda\)-zmiennymi}.
% \begin{definicja}\label{def:pseudopreterm-simple}(Pseudo-pretermy)\\
%   \emph{Pseudo-pretermami} będziemy nazywali najmniejszy (w sensie mnogościowym) zbiór \(\mathbf{\tilde\Lambda}_{\mathbb{T}}\) taki, że:

%   \begin{enumerate}[label=(PP\arabic*)]
%   \setlength\itemsep{0em}
%   \item Jeśli \(x\in V\), to \(x\in{\mathbf{\tilde\Lambda}}_{\mathbb{T}}\).\label{def:pt-1}
%   \item Jeśli \(M\in\mathbf{\tilde{\Lambda}}_{\mathbb{T}}\) i \(N\in\mathbf{\tilde{\Lambda}}_{\mathbb{T}}\), to \((MN)\in\mathbf{\tilde{\Lambda}}_{\mathbb{T}}\).\label{def:pt-2}
%   \item Dla dowolnych \(x\in V\), \(\sigma\in\mathbb{T}\), \(M\in\mathbf{\tilde{\Lambda}}_{\mathbb{T}}\) mamy, że \((\lambda x:{\sigma}.\,M)\in \mathbf{\tilde{\Lambda}}_{\mathbb{T}}\).\label{def:pt-3}
%   \end{enumerate}
% \end{definicja}
% Elementy \(\mathbf{\tilde\Lambda}_\mathbb{T}\) będziemy oznaczali literami \(L,\ M,\ N,\ P,\ Q,\ R\) i ich wariantami z górnymi lub dolnymi indeksami.Wyrażenia postaci \ref{def:pt-2} nazywamy \emph{aplikacjami} \(M\) do \(N\), zaś wyrażenia postaci \ref{def:pt-3} -- \emph{\(\lambda\)-abstrakcjami}, gdzie o wszystkich podtermach termu \(M\) mówi się, że są w \emph{zasięgu} \(\lambda\)-abstraktora, zaś o \(\lambda\)-zmiennej \(x\) mówi się, że jest nim \emph{związana}. Definicję \ref{def:pseudopreterm-simple} można równoznacznie wyrazić przy pomocy notacji Backusa-Naura. Wówczas ma ona następującą, zwięzłą postać:
% \begin{align*}
%   \mathbf{\tilde\Lambda}\ \leftarrow \ V\ |\ (\mathbf{\tilde\Lambda}\,\mathbf{\tilde\Lambda}) \ |\ (\lambda V.\, \mathbf{\tilde\Lambda})
% \end{align*}

% Stosujemy analogiczne konwencje notacyjne do tych proponowanych przy Definicji \ref{def:lambda-untyped}.

\begin{definicja}(Stwierdzenie, deklaracja, kontekst, sąd)
  \begin{enumerate}[label=(\arabic*)]
  \setlength\itemsep{0em}
  \item \emph{Stwierdzeniem} (ang. \emph{statement}) nazywamy każdy napis postaci \(M:\sigma\), gdzie \(M\in\mathbf{\Lambda}\) i \(\sigma\in\mathbb{T}\). W stwierdzeniu \(M:\sigma\) \(\lambda\)-term \(M\) nazwamy \emph{podmiotem} (ang. \emph{subject}), zaś \(\sigma\) -- \emph{predykatem}.
  \item \emph{Deklaracją} (ang. \emph{declaration}) nazywamy każde stwierdzenie w którym podmot jest zmienną termową.
  \item \emph{Kontekstem} (ang. \emph{context}) nazywamy skończony liniowo uporządkowany zbiór (\emph{listę}) deklaracji, w którym wszystkie podmioty są wzajemnie różne.
  \item \emph{Sądem} (ang. \emph{judgement}) nazywamy kazdy napis postaci \(\Gamma\vdash M:\sigma\), gdzie \(\Gamma\) jest kontekstem, zaś \(M:\sigma\) -- stwierdzeniem.  
  \end{enumerate}
\end{definicja}

\begin{definicja}
  \begin{enumerate}[label=(\arabic*)]
  \setlength\itemsep{0em}
  \item Jeśli \(\Gamma=(x_1:\sigma_1,\,\dots,\,x_n:\sigma_n)\), to liniowo
    uporządkowany zbiór \( \mathrm{dom} \Gamma = (x_1,\dots,x_n) \) nazywamy
      \emph{dziedziną} kontekstu \(\Gamma\).
    \item Kontekst \(\Gamma'\) nazywamy \emph{podkontekstem} \(\Gamma\) i piszemy \(\Gamma'\subseteq\Gamma\), jeśli wszystkie deklaracje występujące w \(\Gamma\) występują również w \(\Gamma\) z zachowaniem tego samego porządku.
    \item Kontekst \(\Gamma'\) nazywamy \emph{permutacją} kontekstu \(\Gamma\), jeśli wszystkie deklaracje w \(\Gamma'\) występują w \(\Gamma\) i odwrotnie.
    \item Jeśli \(\Gamma\) jest kontekstem i \(\Phi\) jest zbiorem \(\lambda\)-zmiennych, wówczas \emph{projekcją} \(\Gamma\) na \(\Phi\) (symbolicznie \(\Gamma \upharpoonright \Phi\)) nazywamy podkontekst \(\Gamma'\) kontekstu \(\Gamma\) taki, że \(\mathrm{dom} \Gamma' = (\mathrm{dom} \Gamma) \cap \Phi\)  
    \item Dla kontekstów \(\Gamma=(x_1:\sigma_1,\,\dots,\,x_k:\sigma_m)\) i \(\Gamma'=(y_1:\rho_1,\,\dots\,y_n:\rho_n)\) takich, że \(\mathrm{dom}(\Gamma)\cap\mathrm{dom}(\Gamma')=\emptyset\) \emph{konkatenacją} \(\Gamma\) i \(\Gamma'\) nazywamy kontekst
      \[
        \Gamma \concat \Gamma' = (x_1:\sigma_1,\,\dots,\,x_k:\sigma_m,\,y_1:\rho_1,\,\dots\,y_n:\rho_n).
      \]
  \end{enumerate}
\end{definicja}
\begin{przyklad}
  Niech \(\Gamma\equiv(y:\sigma,\,x_1:\rho_1,\,x_2:\rho_2,\,z:\tau,\,x_3:\rho_3)\). Wówczas:
  \begin{enumerate}[label=(\arabic*)]
    \setlength\itemsep{0em}
    \item \(\mathrm{dom}\,\Gamma=(y,\,x_1,\,x_2,\,z,\,x_3)\).
    \item \(\emptyset \subseteq (x_1:\rho_1,\,z:\tau)\subseteq\Gamma\)
    \item \((x_1:\rho_1,\,x_2:\rho_2,\,x_3:\rho_3,\,y:\sigma,\,z:\tau)\) jest permutacją \(\Gamma\).
    \item \(\Gamma\upharpoonright \{z,\,u,\,x_1\}=(x_1:\rho_1,\,z:\tau).\)
  \end{enumerate}
\end{przyklad}
Wprowadzamy następujące reguły wyprowadzania typu:
\vspace{0.5em}
    \begin{center}
    \begin{tabular}{ ccc}
      {\begin{prooftree}
        \Hypo{}
        \Infer1[(var)]{\Gamma, x:\sigma\vdash x:\sigma}
      \end{prooftree}},
      \quad 
      {\begin{prooftree}
        \Hypo{\Gamma \vdash M:\varphi \to \psi} \Hypo{ \Gamma \vdash N:\varphi}
        \Infer2[(app)]{\Gamma \vdash (MN):\psi}
      \end{prooftree}},
      \vspace{1em}
      \\ 
      {\begin{prooftree}
        \Hypo{ \Gamma, x:\varphi \vdash M:\psi }
        \Infer1[(abs)]{\Gamma \vdash (\lambda\, x.\, M):\varphi\to\psi}
      \end{prooftree}}.
      \end{tabular}
\end{center}
\vspace{0.5em}

\begin{definicja}(Typowalność)\\
  Mówimy, że \(\lambda\)-term \(M\) jest typu \(\sigma\) w kontekście \(\Gamma\) (jest \emph{typowalny}), jeśli istnieje skończone drzewo sądów spełniające poniższe warunki:
  \begin{enumerate}[label=(D\arabic*)]
      \setlength\itemsep{0em}
      \item W korzeniu drzewa znajduje się sąd \(\Gamma \vdash M:\sigma\).
      \item Liście są \emph{aksjomatami}, czyli sądami postaci \(\Gamma, x:\sigma \vdash x:\sigma\).
      \item Każdego rodzica można otrzymać z jego dzieci przez zastosowanie którejś z reguł wyprowadzania typu.
  \end{enumerate}
  Tak określony obiekt będziemy nazywali \emph{wyprowadzeniem} typu dla \(M\) (w kontekście \(\Gamma\)) i pisali \(\Gamma \vdash_\mathbb{T} M:\sigma\). O sądzie \(\Gamma \vdash M:\sigma\) będziemy wówczas mówili, że jest \emph{wyprowadzalny}. %Jeśli wyprowadzalność stwierdzenia będzie jednoznacznie wynikała z kontekstu, to będziemy omijać indeks \(\mathbb{T}\) przy symbolu \(\vdash_\mathbb{T}\).
\end{definicja}

\begin{definicja}(Poprawność)
  \(\lambda\)-term \(M\in\mathbf{\Lambda}\) nazywamy \emph{poprawnym} (ang. \emph{legal}), jeśli istnieje wyprowadzenie \(\Gamma\vdash M:\rho\) dla pewnego kontekstu \(\Gamma\) i typu \(\rho\in\mathbb{T}\). 
\end{definicja}
\begin{lemat}(O podtermie)
  Podterm poprawnego \(\lambda\)-termu jest poprawny.
  % (Given as Proposition 3.2.9 (see also 3.1.9) in Barendregt, 1992.)
\end{lemat}
\begin{dowod}
  Załóżmy, że sąd \(J: \Gamma\vdash M:\sigma\) jest wyprowadzalny. Dowód przebiega przez indukcję wględem długosci wyprowadzenia \(J\). Rozważmy następujące przypadki:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item Jeśli \(J\) jest konsekwencją reguły \emph{var}, to \(\mathrm{Sub}(M)=\{M\}\) (Definicja~\ref{def:untyped_subterm}.\ref{def:untyped_subterm_1}), a zatem teza jest trywialnie spełniona.
     \item Jesli \(J\) jest konsekwencją reguły \emph{app}, to \(M\equiv PQ\) dla \(P,\,Q\) dla których twierdzenie zachodzi. Ponieważ \(\mathrm{Sub}(M)=\mathrm{Sub}(P)\cup\mathrm{Sub}(Q)\cup\{PQ\}\) (Definicja~\ref{def:untyped_subterm}.\ref{def:untyped_subterm_2}), to teza również zachodzi.
    \item Jeśli \(J\) jest konsekwencją reguły \emph{abs}, to \(M\equiv \lambda
      x.\,P\) dla pewnego \(P\) dla którego twierdzenie zachodzi. Ponieważ
      \(\mathrm{Sub}(\lambda x.\,M) = \mathrm{Sub}(M) \cup \{\lambda x.\,M\}\),
      (Definicja~\ref{def:untyped_subterm}.\ref{def:untyped_subterm_3})
      to teza zachodzi również w tym przypadku.
  \end{enumerate}
  \qed
\end{dowod}

\begin{lemat}(O zmiennych wolnych)
  Jeśli sąd \(J: \Gamma \vdash L:\sigma\) jest wyprowadzalny, to \(\mathrm{FV}(L)\subseteq \mathrm{dom}\,\Gamma\).
\end{lemat}
\begin{dowod}
  Prosty dowód przeprowadzamy przez indukcję względem długości wyprowadzenia sądu \(J\). Rozważmy następujące przypadki:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item Jeśli \(J\) jest konsekwencą reguły \emph{var}, to \(L\equiv x\) dla pewnej \(\lambda\)-zmiennej \(x\). Wobec tego \(x:\sigma\in\Gamma\), a zatem \(\mathrm{FV}(x)\subseteq\mathrm{dom}\,\Gamma\).
    \item Jesli \(J\) jest konsekwencją reguły \emph{app}, to \(J\) musi mieć postać \(\Gamma\vdash MN:\sigma\). Z założenia indukcyjnego: \(\mathrm{FV}(M)\subseteq \mathrm{dom}\,\Gamma\) i  \(\mathrm{FV}(N)\subseteq \mathrm{dom}\,\Gamma\). Z Definicji \ref{def:untyped_fv}: \(\mathrm{FV}(MN)=\mathrm{FV}(M)\cup\mathrm{FV}(N)\). Stąd \(\mathrm{FV}(MN)\subseteq \mathrm{dom}\,\Gamma\).
    \item Jesli \(J\) jest konsekwencją reguły \emph{abs}, to \(J\) musi mieć postać \(\Gamma\vdash \lambda x.\,M:\sigma\). Z założenia indukcyjnego \(FV(M)\subseteq\mathrm{dom}\,\Gamma\). Ponieważ \(\mathrm{FV}(\lambda x.\,M)=\mathrm{FV}(M)\setminus\{x\}\subseteq\mathrm{FV}(M)\) (z Definicji \ref{def:untyped_fv}), to \(\mathrm{FV}(M)\subseteq\mathrm{dom}\,\Gamma\). 
  \end{enumerate}  
  \qed
\end{dowod}

\begin{lemat}
  \begin{enumerate}[label=(\arabic*)]
    \setlength\itemsep{0em}
    \item Niech \(\Gamma'\) i \(\Gamma''\) bedą kontekstami takimi, że \(\Gamma' \subseteq \Gamma''\). Jeśli \(\Gamma'\vdash M:\sigma\), to \(\Gamma''\vdash M:\sigma\).
    \item Jeśli \(\Gamma\vdash M:\sigma\), to \(\Gamma \upharpoonright \mathrm{FV}(M)\vdash M:\sigma\).
    \item Jeśli \(\Gamma\vdash M:\sigma\) i \(\Gamma'\) jest permutacją \(\Gamma\), to \(\Gamma'\vdash M:\sigma\).
  \end{enumerate}
\end{lemat}
\begin{dowod}
  Dowody przebiegają przez indukcję względem długości wyprowadzenia. Czytelnika zainteresowanego szczegółami odsyłamy do \cite[Tw. 3.1.7]{Barendregt_1992}. 
  \qed
\end{dowod}

\begin{lemat}(O generowaniu)\label{thm:generation}
  \begin{enumerate}[label=(\arabic*)]
     \setlength\itemsep{0em}
     \item Jeśli \(\Gamma\vdash_{\mathbb{T}} x:\sigma\), to \(x:\sigma\in\Gamma\).\label{thm:generation_1}
     \item Jeśli \(\Gamma\vdash_{\mathbb{T}}MN:\tau\), to \(\Gamma\vdash_\mathbb{T} M:\sigma\to\tau\) i \(\Gamma\vdash_\mathbb{T} N:\sigma\) dla pewnego \(\sigma\in\mathbb{T}\).\label{thm:generation_2}
     \item Jeśli \(\Gamma\vdash_{\mathbb{T}}\lambda x.\, M:\tau\) i \(x\not\in\mathrm{dom}\,\Gamma\), to \(\tau\equiv \tau_1\to\tau_2\) oraz \(\Gamma,x:\tau_1\vdash_\mathbb{T} N:\tau_2\). \label{thm:generation_3}
  \end{enumerate} 
\end{lemat}
\begin{dowod}
   \begin{enumerate}[label=(\arabic*)]
     \setlength\itemsep{0em}
     \item \label{proof:generation_1}
     \item[(2,3)] Analogicznie do \ref{proof:generation_1}.
   \end{enumerate}
  \qed
\end{dowod}

\begin{lemat}(O podstawieniu)\label{thm:substitution}
  Załóżmy, że
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item \(\Gamma,\,x:\sigma\vdash M:\rho\) 
    \item \(\Gamma\vdash N:\sigma\)
  \end{enumerate}
  Wówczas \(\Gamma \vdash M[x/N]:\rho\).
\end{lemat}
\begin{dowod}
%  Dowód przebiega przez indukcję względem długości wyprowadzenia typu \(M\). 
%   \begin{enumerate}[label=(\roman*)]
%    \setlength\itemsep{0em}
  Dowód przeprowadzimy przez indukcję względem długości wyprowadzenia \(\Gamma,\,x:\sigma\vdash M:\rho\). Rozważmy następujące przypadki:
    \begin{enumerate}[label=(\roman*)]
      \setlength\itemsep{0em}
      \item   Jeśli    \(\Gamma,\,x:\sigma\vdash   M:\rho\)   jest
konsekwencją reguły  \emph{var},  to   \(M\equiv  x\).  Wówczas
        \(M[x/N]\equiv N\) i \(\rho \equiv  \sigma\). Teza zachodzi w oczywisty
sposób.
      \item  \(\Gamma,\,x:\sigma\vdash M:\rho\)  jest konsekwencją
      reguły  \emph{app}.   Wówczas \(M\equiv  PQ\)   i  istnieją
      wyprowadzenia    \(\Gamma,\,x:\sigma\vdash    P:\tau\to\rho\)
      oraz  \(\Gamma,\,  x:\sigma\vdash   Q:\tau\).  Z  założenia
      indykcyjnego  mamy,  że \(  \Gamma\vdash  P[x/N]:\tau\to\rho
        \)   oraz   \(   \Gamma\vdash   Q[x/N]:\tau   \). Wówczas stosując regułę \emph{app} mamy:
      \begin{center}
      {\begin{prooftree}
        \Hypo{\Gamma \vdash P[x/N]:\tau \to \rho} \Hypo{ \Gamma \vdash Q[x/N]:\tau}
        \Infer2[(app)]{\Gamma \vdash (P[x/N]Q[x/N]):\rho}
      \end{prooftree}},
      \end{center}
      Tezę otrzymujemy z faktu, że \((PQ)[x/N]=P[x/N]Q[x/N]\). 
    \item Jeśli \(\Gamma,\,x:\sigma\vdash   M:\rho\) jest konsekwencją reguły \emph{abs}, to \(M\equiv \lambda y.\,P:\rho\) dla \(\rho\equiv \sigma\to\tau,\,y\not\equiv x\). Z założenia indukcyjnego istnieje wyprowadzenie
      \( \Gamma',\,y:\tau\vdash P[x/N]:\rho \), gdzie \(\Gamma'=\Gamma\concat (x:\sigma)\).
        Wówczas, stosując regułę \emph{abs} mamy:
      \begin{center}  
        {\begin{prooftree}
          \Hypo{ \Gamma', y:\tau\vdash P[x/N]:\rho}
          \Infer1[(abs)]{\Gamma' \vdash (\lambda\, y.\, P[x/N]):\tau\to\rho}
        \end{prooftree}}
      \end{center}
        Ponieważ \((\lambda y.\,P)[x/N]=\lambda y.\,P[x/N]\) oraz \(M\equiv \lambda y.\,P:\tau\to\rho\), otrzymujemy tezę.
    \end{enumerate}
    \item    
  \qed
%  \end{enumerate}
\end{dowod}
\begin{lemat}(Redukcja podmiotu)
    Załóżmy, że
    \begin{enumerate}[label=(\roman*)]
      \setlength\itemsep{0em}
      \item \(\Gamma\vdash_\mathbb{T} M:\sigma\) 
      \item \(M\to^{*}_\beta N\)
    \end{enumerate}
    Wówczas \(\Gamma\vdash_\mathbb{T}N:\sigma\).
\end{lemat}
\begin{dowod}
  Pokażemy, że twierdzenie zachodzi dla jednego kroku redukcji \(\to_\beta\). Dowód zwrotności jest trywialny, zaś aby pokazać przechodniość wystarczy skorzystać z indukcji wzgledem długości ciągu redukcji.

  Niech \(M\to_\beta N\). Dowód przeprowadzimy przez indukcję względem długości wyprowadzenia \(\Gamma\vdash M:\sigma\). Rozważmy następujące przypadki:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item    \(\Gamma\vdash     M:\sigma\)    jest    konsekwencją
    reguły   \emph{var}.  Wówczas   \(M\equiv   x\)  dla   pewnej
    \(\lambda\)-zmiennej  \(x\in   V\).  Wówczas   poprzednik  nie
    jest  spełniony,   bowiem  \(M\)  nie  da   się  zredukować.
    Zatem  twierdzenie  trywialnie zachodzi.  
  
    \item  \(\Gamma\vdash  M:\sigma\)  jest  konsekwencją  reguły
    \emph{app}.    Wówczas   \(M\equiv    PQ\)   oraz    istnieją
    wyprowadzenia  \(\Gamma\vdash   P:\tau\to\sigma\)  oraz  \(\Gamma
    \vdash   Q:\sigma\).   Ponadto   zakładamy,  że   dla   pewnych
    \(P',\,Q'\in\mathbf{\Lambda}\)   mamy   \(P\to_\beta   P'\)   i
    \(Q\to_\beta   Q'\).  Istnieją   dwie  możliwości   redukcji
    \(M\to_\beta N\):
      \begin{enumerate}[label=(\arabic*)]
        \setlength\itemsep{0em}
        \item \(N\equiv PQ'\). Poniważ \(\Gamma\vdash Q':\sigma\) (założenie indukcyjne), to możemy zastosować regułę \emph{app}:

        \begin{center}
          {\begin{prooftree}
            \Hypo{\Gamma \vdash P:\tau \to \sigma} \Hypo{ \Gamma \vdash Q':\tau}
            \Infer2[(app)]{\Gamma \vdash PQ':\sigma}
          \end{prooftree}},
        \end{center}
          Ponieważ \(N\equiv PQ'\), to otrzymujemy tezę. 
          \label{thm:subject_reduction_1}
        \item \(N\equiv P'Q\). Postępujemy analogicznie do przypadku \ref{thm:subject_reduction_1}
      \end{enumerate}
    \item  \(\Gamma\vdash  M:\sigma\)  jest  konsekwencją  reguły
    \emph{abs}.  Wówczas \(M\equiv  \lambda  x.\,P\), dla  pewnych
    \(\rho,\,\tau\in\mathbb{T}\) mamy  \(\sigma\equiv \rho\to\tau\)
    oraz   istnieje  wyprowadzenie   sądu  \(\Gamma,\,x:\rho\vdash
      P:\tau\). Ponadto zakładamy, że dla pewnego \(P'\in\mathbf{\Lambda}\)
      mamy \(P\to_\beta P'\). \(\beta\)-redukcja \(M\to_\beta N\) musi prowadzić w tym wypadku do \(N\equiv \lambda x.\,P'\). Ponieważ \(\Gamma, x:\rho\vdash P':\tau\) (założenie indukcyjne), to możemy zastosowac regułę \emph{abs}:
      \begin{center}  
        {\begin{prooftree}
          \Hypo{ \Gamma', x:\rho\vdash P':\tau}
          \Infer1[(abs)]{\Gamma \vdash \lambda\, x.\, P':\rho\to\tau}
        \end{prooftree}}
      \end{center}

  \end{enumerate}
  \qed
\end{dowod}

\subsection{Silna normalizacja}
\begin{lemat}\label{thm:sn_lemat1}
  Niech \(\tau\in\mathbb{T}\) bedzie dowolnym typem prostym. Wówczas:
  \begin{enumerate}[label=(\arabic*)]
    \setlength\itemsep{0em}
    \item \(\llbracket \tau \rrbracket  \subseteq \mathrm{SN}\).\label{def:l1_a}
    \item Jeśli \(N_1,\,N_2,\,\dots,\,N_k\in\mathrm{SN}\), to \(xN_1 N_2 \dots N_k \in \llbracket \tau \rrbracket\).\label{def:l1_b}
  \end{enumerate}
\end{lemat}
\begin{dowod}
  Dowód przeprowadzimy przez indukcję strukturalną względem \(\tau\). Mamy do rozważenia następujące dwa przypadki:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item \(\tau\) jest zmienną typową.
     \begin{enumerate}[label=(\arabic*)]
      \setlength\itemsep{0em}
     
        \item Wynika bezpośrednio z definicji \(\llbracket \tau \rrbracket\in \mathrm{SN}\). 
         
        \item Niech \(N_1,\,N_2,\,\dots,\,N_k \in \mathrm{SN}\). Wówczas \(N_1,\,N_2,\,\dots,\,N_k\in\mathrm{SN}\). Z definicji \(\llbracket \tau \rrbracket\) mamy, że \(xN_1 N_2 \dots N_k \in\llbracket \tau \rrbracket\).
      \end{enumerate}

    \item Przypuśćmy, że \(\tau=\sigma\to\rho\) oraz twierdzenie zachodzi dla \(\sigma\) i \(\rho\).
    \begin{enumerate}[label=(\arabic*)]
    \setlength\itemsep{0em}

    \item Niech \(M\in\llbracket \sigma \to \rho\rrbracket\) i niech \(x\) bedzie dowolną \(\lambda\)-zmienną. Z części \ref{def:l1_b} założenia indukcyjnego mamy \(x\in\llbracket \sigma \rrbracket\), zatem z definicji \(\llbracket \sigma\to\rho\rrbracket\) mamy \(Mx\in\llbracket p\rrbracket\). Ponieważ z części \ref{def:l1_a} założenia indukcyjnego \(\llbracket\rho\rrbracket\in\mathrm{SN}\), to \(Mx\in\mathrm{SN}\) i w konsekwencji \(\llbracket\sigma\to\rho\rrbracket\subseteq \mathrm{SN}\).
    \item Niech \(P\in\llbracket \sigma \rrbracket\). Wówczas z części \ref{def:l1_a} założenia indukcyjnego \(P\in\mathrm{SN}\). Chcemy pokazać, że \(xN_1 N_2 \dots N_k \in \llbracket \rho \rrbracket\). Z części \ref{def:l1_b} założenia indukcyjnego \[xN_1 N_2 \dots N_k N_{k+1} \in \llbracket \rho \rrbracket.\] Ustalając \(N_{k+1}\equiv P\) otrzymujemy tezę.
     \end{enumerate}
  \end{enumerate}
  \qed
\end{dowod}

\begin{lemat}\label{thm:sn_lemat2}
  Załóżmy, że:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item  \(M[x/N_0]N_1\dots N_k\in\mathrm{SN}\),\label{def:l2_a}
    \item  \(N_0\in \mathrm{SN}\).\label{def:l2_b}
  \end{enumerate}
  Wówczas \((\lambda x.\,M)N_0 N_1 \dots N_k \in \mathrm{SN}\).
\end{lemat}
\begin{dowod}
  (Ad  absurdum) Przypuśćmy,  że  \(P_0\equiv(\lambda  x.\, M)N_0  N_1
  \dots N_k \not\in\mathrm{SN}\). Wówczas istnieje nieskończony ciąg redukcji
  \[
    P_0\to P_1 \to \dots
  \]
  Każdy podterm \(\lambda\)-termu silnie normalizowalnego jest silnie
  normalizowalny. Ponieważ \(P_0\equiv M[x/N_0]N_0  N_1 \dots N_k
  \in\mathrm{SN}\), to \(M[x/N_0],\,N_0,\,  N_1,\, \dots,\, N_k
  \in\mathrm{SN}\). Na podstawie Lematu \ref{thm:sn_lem2'} mamy ponadto, że \(M\in\mathrm{SN}\). Wobec tego dla pewnego \(n\in\mathbb{N}\) redukcji ulega redeks czołowy:
  \begin{align*}
    P_n\equiv (\lambda x.\,M')N'_0 N'_1 \dots N'_k\to_\beta M'[x/N'_0]N'_0 N'_1\dots N'_k\equiv P_{n+1},
  \end{align*}
    gdzie \(M\to^{*}_\beta M'\) oraz \(N_i \to^{*}_\beta N'_i\) dla \(i\leq k\). Ale skoro tak, to prawdą jest również, że \(M[x/N_0]N_1\dots N_k \to^{*}_\beta P_{n+1}\), zaś \(M[x/N_0]N_1\dots N_k \in \mathrm{SN}\). Zatem \(P_{n+1}\in\mathrm{SN}\), co prowadzi do sprzeczonści.
  \qed
\end{dowod}
\begin{lemat}\label{thm:sn_lemat3}
  Załóżmy, że:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item  \(M[x/N_0]N_1\dots N_k\in \llbracket \tau \rrbracket\),\label{def:l3_a}
    \item  \(N_0\in \mathrm{SN}\).\label{def:l3_b}
  \end{enumerate}
  Wówczas \((\lambda x.\,M)N_0 N_1 \dots N_k \in \llbracket \tau \rrbracket \).
\end{lemat}
\begin{dowod}
  Dowód przebiega przez indukcję strukturalną względem \(\tau\). Rozważmy następujące przypadki:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item Jeśli \(\tau\) jest zmienną typową, to \(\llbracket \tau \rrbracket=\mathrm{SN}\). Wobec tego problem sprowadza się do Lematu \ref{thm:sn_lemat2}.  
    \item Przypuśćmy, że \(\tau\equiv \sigma\to\rho\) i niech \(M[x/N_0]N_1\dots N_k \in \llbracket \sigma\to \rho \rrbracket\). Wybierzmy dowolny \(P\in\llbracket\sigma\rrbracket\). Wówczas \(M[x/N_0] N_1 \dots N_k N_{k+1}\in\llbracket \rho\rrbracket\). Z założenia indukcyjnego mamy jednak, że 
      \(
        (\lambda x.\,M)N_0 N_1\dots N_k N_{k+1}\in\llbracket \rho \rrbracket.
      \)
      Wystarczy więc przyjąć \(N_{k+1}\equiv P\) i z definicji \(\llbracket \sigma \to \rho \rrbracket\) mamy, że \((\lambda x.\,M)N_0 N_1 \dots N_k \in \llbracket \sigma \to \rho \rrbracket\).
  \end{enumerate}
  \qed
\end{dowod}
\begin{definicja}
  Powiemy, że kontekst \(\Gamma=\{x_1:\sigma_1,\,x_2:\sigma_2,\dots ,\,x_n:\sigma_n\}\) \emph{spełnia} stwierdzenie \(M:\sigma\) i będziemy pisali \(\Gamma\models M:\sigma\), jeśli dla dowolnych \(N_1\in\llbracket \sigma_1 \rrbracket\), \(N_2\in\llbracket \sigma_2 \rrbracket\), \(\dots\), \(N_n\in\llbracket \sigma_n \rrbracket\) mamy, że:
  \[
    M[x_1/N_1,\,x_2/N_2,\,\dots,\,x_n/N_n]\in\llbracket \tau \rrbracket.
  \]
\end{definicja}
\begin{lemat}\label{thm:o_poprawnosci}
  Jeśli \(\Gamma\vdash_{\mathbb{T}}M:\tau\), to \(\Gamma\models M:\tau\).
\end{lemat}
\begin{dowod}
  Dowód będzie przebiegał przez indukcję względem wyprowadzenia \(\Gamma\vdash M:\tau\). Niech \(\Gamma=(x_1:\tau_1,\,x_2:\tau_2,\,\dots,\,x_n:\tau_n)\) będzie kontekstem dla którego istnieje wyprowadzenie \(J:\:\Gamma\vdash M:\tau\). Wybierzmy \(N_1\in\llbracket\tau_1 \rrbracket,\,N_2\in\llbracket\tau_2\rrbracket,\,\dots,\,N_n\in\llbracket\tau_n\rrbracket\). Rozważmy następujące przypadki:
  \begin{enumerate}[label=(\alph*)]
    \setlength\itemsep{0em}
    \item \(J\) jest konsekwencją reguły \emph{var}. Wówczas \(J\) jest postaci \(\Gamma \vdash x_i:\tau\) dla pewnego \(i\in\mathbb{N}\), \(1\leq i\leq n\), gdzie \(x_i:\tau\in\Gamma\). Stąd \(M[\vec{x}/\vec{N}]=x_i[x_i/N_i]=N_i\in\llbracket \tau \rrbracket\). Z dowolności \(N_i\), \(\Gamma\vDash M:\tau\).
    \item \(J\) jest konsekwencją reguły \emph{app}. Wówczas \(J\) jest postaci \(\Gamma\vdash PQ:\tau\). Z założenia indukcyjnego istnieje \(\sigma\in\mathbb{T}\) takie, że \(\Gamma\models P:\sigma\to\tau\) i \(\Gamma\models Q:\sigma\). Wobec tego \(P[\vec{x}/\vec{N}]\in\llbracket\sigma\to\tau\rrbracket\) i \(Q\llbracket \vec{x}/\vec{N} \rrbracket \in \llbracket \sigma \rrbracket\). Z definicji jednoczesnego podstawienia (Definicja \ref{def:simult_substitution}) mamy:
      \begin{align*}
        PQ[\vec{x}/\vec{N}]=P[\vec{x}/\vec{N}]Q[\vec{x}/\vec{N}]
      \end{align*}
      Z definicji \(\llbracket \sigma \to \tau \rrbracket\) wówczas \(M\in\llbracket \tau\rrbracket\).
    \item \(J\) jest konsekwencją reguły \emph{abs}. Wówczas \(J\) jest postaci \(\Gamma\vdash \lambda y.\,P:\sigma \to\rho\), gdzie \(y\not\in\mathrm{dom}\Gamma\). Z założenia indukcyjnego mamy, że \(\Gamma,y:\sigma\models P:\rho\). Oznacza to, że dla dowolnych \(N_1\in\llbracket\tau_1\rrbracket\), \(N_2\in\llbracket\tau_2\rrbracket\), \(\dots\), \(N_n\in\llbracket\tau_n\rrbracket\) mamy
    \begin{align} 
      \forall N\in\llbracket \sigma \rrbracket\, \left(
        P[\vec{x},y/\vec{N},N]\in\llbracket \rho \rrbracket \tag{\textasteriskcentered} \label{eq:poprawnosc}
      \right)
    \end{align} 
      Ustalmy \(P'\equiv P[y/y'][\vec{x}/\vec{N}]\), gdzie \(y'\not\in \mathrm{dom}\Gamma\) i \(y'\not \in \mathrm{FV}(N_i)\) dla \(i\in\mathbb{N}\), \(1\leq i\leq n\). Wówczas z \eqref{eq:poprawnosc}:
      \begin{align*}
        \forall N\in\llbracket\sigma\rrbracket\, \left(
        P'[y'/N]\in\llbracket \rho \rrbracket
        \right )
      \end{align*}
      Ustalmy \(N_0\in\llbracket \sigma \rrbracket\). Wówczas z cześci \ref{def:l1_a} Lematu \ref{thm:sn_lemat1} \(N_0\in\mathrm{SN}\). Wobec tego z Lematu \ref{thm:sn_lemat3} wnioskujemy, że:
      \begin{align}
        (\lambda y'.\,P')N_0\in\llbracket \rho \rrbracket \tag{\textasteriskcentered\textasteriskcentered}\label{eq:sn_2}
      \end{align}
      Zauważmy teraz, że ponieważ \(\forall i\ y_i\not\in\mathrm{FV}(N_i) \)
      \begin{equation}
        \begin{aligned}
        (\lambda y'.\,P')&=(\lambda y'.\,P[y/y'][\vec{x}/\vec{N}])\\
                         &=(\lambda y'.\,P[y/y'])[\vec{x}/\vec{N}]
                         =(\lambda y.\,P)[\vec{x}/\vec{N}] 
        \end{aligned} \tag{\textasteriskcentered\textasteriskcentered\textasteriskcentered}\label{eq:sn_3}
      \end{equation}
      Z \eqref{eq:sn_2} i \eqref{eq:sn_3} otrzymujemy     
      \[
        \left(
          (\lambda y.\,P)[\vec{x}/\vec{N}]
        \right)
        N_0 \in \llbracket \rho \rrbracket .
      \]
      Ponieważ \(N_0\in\llbracket \sigma \rrbracket\), to z definicji \(\llbracket \sigma \to \rho \rrbracket\) mamy, że 
      \[
        (\lambda y.\,P)[\vec{x}/\vec{N}]\in\llbracket \sigma \to \rho \rrbracket.
      \]
      Z dowolności \(\vec{N}\) otrzymujemy ostatecznie, że \(\Gamma\models \lambda y.\,P\).
  \end{enumerate}
  \qed
\end{dowod}
\begin{twierdzenie}(O silnej normalizacji)
  Jeżeli \(\Gamma\vdash_\mathbb{T}M:\tau\), to \(M\in\mathrm{SN_\beta}\).
\end{twierdzenie}
\begin{dowod}
  Na podstawie Lematu \ref{thm:o_poprawnosci}, jeśli \(\Gamma\vdash_\mathbb{T} M:\tau\), to \(M\in\llbracket \tau \llbracket\). Stosując Lemat \ref{thm:sn_lemat1} otrzymujemy tezę. \qed
\end{dowod}
